<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Apertura de Cuenta</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancelar()">
        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Nueva Cuenta Bancaria</ion-card-title>
      <ion-card-subtitle>Complete los datos requeridos</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <form (ngSubmit)="abrirCuenta()">
        <!-- Cliente (solo admin) -->
        <ion-item *ngIf="esAdmin" fill="outline" class="ion-margin-bottom">
          <ion-label position="floating">Seleccionar Cliente</ion-label>
          <ion-select [(ngModel)]="datosCuenta.clienteId" name="clienteId" required interface="action-sheet">
            <ion-select-option *ngFor="let cliente of clientes" [value]="cliente.clienteId">
              {{ cliente.nombreCompleto }} - {{ cliente.identificacion }} ({{ cliente.correo }})
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Tipo de cuenta -->
        <ion-item fill="outline" class="ion-margin-bottom">
          <ion-label position="floating">Tipo de Cuenta *</ion-label>
          <ion-select [(ngModel)]="datosCuenta.tipoCuenta" name="tipoCuenta" required interface="action-sheet">
            <ion-select-option *ngFor="let tipo of tiposCuenta" [value]="tipo">
              {{ tipo }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Moneda -->
        <ion-item fill="outline" class="ion-margin-bottom">
          <ion-label position="floating">Moneda *</ion-label>
          <ion-select [(ngModel)]="datosCuenta.moneda" name="moneda" required interface="action-sheet">
            <ion-select-option *ngFor="let moneda of monedas" [value]="moneda">
              {{ moneda === 'CRC' ? 'Colones (₡)' : 'Dólares ($)' }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Saldo inicial -->
        <ion-item fill="outline" class="ion-margin-bottom">
          <ion-label position="floating">Saldo Inicial *</ion-label>
          <ion-input type="number" [(ngModel)]="datosCuenta.saldoInicial" name="saldoInicial" required min="0"
            step="0.01"></ion-input>
        </ion-item>

        <!-- Alias (opcional) -->
        <ion-item fill="outline" class="ion-margin-bottom">
          <ion-label position="floating">Alias (opcional)</ion-label>
          <ion-input type="text" [(ngModel)]="datosCuenta.alias" name="alias" maxlength="30"
            placeholder="Ej: Cuenta Principal"></ion-input>
        </ion-item>

        <!-- Resumen -->
        <ion-card *ngIf="datosCuenta.tipoCuenta && datosCuenta.moneda" color="light">
          <ion-card-header>
            <ion-card-title>Resumen</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Tipo:</strong> {{ datosCuenta.tipoCuenta }}</p>
            <p><strong>Moneda:</strong> {{ datosCuenta.moneda === 'CRC' ? 'Colones (₡)' : 'Dólares ($)' }}</p>
            <p><strong>Saldo Inicial:</strong>
              {{ datosCuenta.moneda === 'CRC' ? '₡' : '$' }}
              {{ datosCuenta.saldoInicial.toLocaleString('es-CR') }}
            </p>
          </ion-card-content>
        </ion-card>

        <!-- Botones -->
        <div class="ion-margin-top">
          <ion-button expand="block" color="primary" type="submit" [disabled]="!formularioValido() || loading">
            <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
            <span *ngIf="!loading">Abrir Cuenta</span>
          </ion-button>

          <ion-button expand="block" color="medium" fill="outline" (click)="cancelar()" class="ion-margin-top">
            Cancelar
          </ion-button>
        </div>
      </form>
    </ion-card-content>
  </ion-card>
</ion-content>